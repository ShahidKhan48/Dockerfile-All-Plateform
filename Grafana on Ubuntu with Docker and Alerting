# Use Ubuntu as the base image
FROM ubuntu:20.04

# Install necessary dependencies
RUN apt-get update && apt-get install -y \
    apt-transport-https \
    software-properties-common \
    curl \
    wget \
    gnupg2 \
    ca-certificates

# Install Grafana (Stable Release)
RUN wget -q -O - https://packages.grafana.com/gpg.key | apt-key add - && \
    add-apt-repository "deb https://packages.grafana.com/oss/deb stable main" && \
    apt-get update && apt-get install -y grafana

# Install Docker
RUN curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - && \
    add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" && \
    apt-get update && apt-get install -y docker-ce-cli

# Install Python (optional, if you need it for any integrations)
RUN apt-get install -y python3 python3-pip

# Enable Grafana alerting and configure alerting options
ENV GF_ALERTING_ENABLED="true"
ENV GF_SMTP_ENABLED="true"

# Expose Grafana's default port
EXPOSE 3000

# Set up Grafana directories (optional: custom config and provisioning)
VOLUME ["/var/lib/grafana", "/etc/grafana/provisioning"]

# Start Grafana and Docker service
CMD service docker start && /usr/sbin/grafana-server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=deb cfg:default.paths.data=/var/lib/grafana cfg:default.paths.logs=/var/log/grafana cfg:default.paths.plugins=/var/lib/grafana/plugins
